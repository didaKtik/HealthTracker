var app=app||{};!function(){"use strict";app.isMobile=window.matchMedia("only screen and (max-width: 760px)").matches,app.touchEvent=app.isMobile?"touchstart":"mousedown",app.reset=function(){Backbone.trigger("resetAll")},$("body").on(app.touchEvent,function(e){e.target===this&&(e.preventDefault(),app.reset())})}();var app=app||{};!function(){"use strict";var e=Backbone.Collection.extend({localStorage:new Backbone.LocalStorage("foods"),initialize:function(){this.fetch()},getCalories:function(){return this.length?this.reduce(function(e,t){return e+t.get("calories")},0):0}});e.prototype.create=function(e){var t=this.any(function(t){var s=t.get("name")===e.get("name"),i=t.get("restaurant")===e.get("restaurant");return s&&i});return t?!1:Backbone.Collection.prototype.create.call(this,e.attributes)},app.foods=new e}();var app=app||{};!function(){"use strict";var e=Backbone.Collection.extend({localStorage:new Backbone.LocalStorage("results"),query:function(){var e="3f4d31c4",t="1db700e86d98a9f42590869fd586e09b",s=app.barView.getText(),i="https://api.nutritionix.com/v1_1/search/",n=JSON.stringify({appId:e,appKey:t,query:s,fields:["item_name","nf_calories","brand_name"],filters:{item_type:1}});$.post({url:i,data:n,contentType:"application/json"}).done(this.onSuccess.bind(this)).fail(this.onError.bind(this))},onSuccess:function(e){var t=this.treat(e);t.length?this.reset(t):this.trigger("noResults")},treat:function(e){return e.hits.map(function(e){var t=e.fields;return{name:t.item_name,restaurant:t.brand_name,calories:t.nf_calories}})},onError:function(e){this.trigger("queryError")}});app.results=new e}();var app=app||{};!function(){"use strict";var e=Backbone.View.extend({el:"#bar-view",events:{keypress:"triggerOnEnter",input:"onTextChange",mousedown:"preventWhenMessaging"},text:"",messaging:!0,initialize:function(){this.listenTo(Backbone,"resetAll",this.reset),this.reset()},reset:function(){this.text="";var e=app.foods.getCalories();this.message("You eat "+e+" calories!")},focus:function(){this.messaging=!1,this.$el.focus(),this.$el.removeClass("messaging"),this.setText("")},setPlaceholder:function(e){this.$el.attr("placeholder",e)},getText:function(){return this.$el.val().trim()},setText:function(e){this.$el.val(e),this.text=e},onTextChange:function(e){var t=this.getText(),s=this.text;""===t&&""!==s&&this.trigger("empty"),""!==t&&""===s&&this.trigger("nonEmpty"),this.text=t},triggerOnEnter:function(e){e.which===ENTER_KEY&&this.trigger("enterKey")},message:function(e){this.messaging=!0,this.$el.blur(),this.$el.addClass("messaging"),this.setText(e)},preventWhenMessaging:function(e){(this.messaging||this.warning)&&e.preventDefault()},warn:function(e,t){var s=1500,t=t||s,i=this.getState();this.message(e),this.$el.removeClass("messaging"),this.$el.addClass("warning"),setTimeout(function(){this.$el.removeClass("warning"),this.setState(i)}.bind(this),t)},getState:function(){var e={};return e.messaging=this.messaging,e.text=this.getText(),e},setState:function(e){e.messaging?this.message(e.text):(this.focus(),this.setText(e.text))}});app.barView=new e}();var app=app||{};!function(){"use strict";app.FoodView=Backbone.View.extend({tagName:"tr",className:"food",template:_.template($("#food-template").html()),events:{"mousedown .destroy button":"destroy","touchstart .destroy button":"destroy"},initialize:function(){this.listenTo(this.model,"destroy",this.remove)},render:function(){return this.$el.html(this.template(this.model.attributes)),this},destroy:function(){this.model.destroy()}})}();var app=app||{};!function(){"use strict";var e=Backbone.View.extend({el:"#list-view",theadHtml:"<tr><th>Food</th><th>Restaurant</th><th>Calories</th><th></th></tr>",render:function(e){this.$el.html(""),this.$el.append(this.theadHtml);var t=e===app.foods?"FoodView":"ResultView";e.each(function(e){var s=new app[t]({model:e});this.$el.append(s.render().el)},this)}});app.listView=new e}();var app=app||{};!function(){"use strict";app.ResultView=Backbone.View.extend({tagName:"tr",className:"result",template:_.template($("#result-template").html()),events:{click:"broadcastClick"},render:function(){return this.$el.html(this.template(this.model.attributes)),this},broadcastClick:function(){Backbone.trigger("resultClick",this.model)}})}();var app=app||{};!function(){"use strict";var e=Backbone.View.extend({el:"#transporter-view",initialize:function(){this.listenTo(Backbone,"resetAll",this.middle)},up:function(){this.$el.removeClass("middle"),this.$el.addClass("up")},middle:function(){this.$el.removeClass("up"),this.$el.addClass("middle")},isUp:function(){return this.$el.hasClass("up")}});app.transporterView=new e}();var app=app||{};!function(){"use strict";app.PlusController=Backbone.View.extend({el:"#plus-controller",active:!1,addMode:!1,events:{touchstart:"onMousedown",mousedown:"onMousedown"},initialize:function(){this.$plus=this.$(".bars"),this.$text=this.$(".text"),this.listenTo(Backbone,"resetAll",this.reset),this.listenTo(app.barView,"nonEmpty",this.setAddMode),this.listenTo(app.barView,"empty",this.unsetAddMode),this.listenTo(app.results,"reset",this.renderResults),this.listenTo(app.results,"noResults",this.onNoResults),this.listenTo(app.results,"queryError",this.onQueryError),this.listenTo(Backbone,"resultClick",this.onResultClick)},onMousedown:function(e){e.preventDefault(),this.active?this.addMode?this.searchResults():app.reset():app.storeController.active?(app.reset(),this.activate()):this.activate()},activate:function(){this.active=!0,app.barView.focus();var e=app.transporterView.isUp()?"Make a new search":"Search for a food";app.barView.setPlaceholder(e)},reset:function(){this.unsetAddMode(),this.active=!1},setAddMode:function(){this.active&&(this.addMode=!0,this.$plus.hide(),this.$text.show(),this.listenTo(app.barView,"enterKey",this.searchResults))},unsetAddMode:function(){this.active&&(this.addMode=!1,this.$text.hide(),this.$plus.show(),this.stopListening(app.barView,"enterKey"))},searchResults:function(){app.results.query(app.results),this.reset(),app.barView.message("...")},onNoResults:function(){this.activate(),app.barView.warn("No results found !")},onQueryError:function(){this.activate(),app.barView.warn("Are you connected ?")},renderResults:function(e){app.transporterView.up(),app.listView.render(e),app.barView.message("Do you eat one of these ?")},onResultClick:function(e){var t=app.foods.create(e);app.reset(),t?app.barView.warn("Food stored !"):app.barView.warn("You already eat this one !")}})}();var app=app||{};!function(){"use strict";app.StoreController=Backbone.View.extend({el:"#store-controller",active:!1,events:{touchstart:"onMousedown",mousedown:"onMousedown"},onMousedown:function(e){e.preventDefault(),this.active?app.reset():app.plusController.active?(app.reset(),this.activate()):this.activate()},initialize:function(){this.listenTo(Backbone,"resetAll",this.reset),this.listenTo(app.foods,"remove",this.resetIfEmpty)},activate:function(){app.foods.length?(this.active=!0,this.renderFoods()):app.barView.warn("You have no foods yet !")},renderFoods:function(){app.listView.render(app.foods),app.barView.message("Here are your foods"),app.transporterView.up()},reset:function(){this.active=!1},resetIfEmpty:function(){app.foods.length||(app.reset(),app.barView.warn("No more foods !"))}})}();var app=app||{},ENTER_KEY=13;$(function(){"use strict";app.storeController=new app.StoreController,app.plusController=new app.PlusController});
//# sourceMappingURL=uglified.js.map
